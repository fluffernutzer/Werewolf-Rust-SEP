<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Werwolf ‚Äì {{ username }} ({{ rolle }})</title>
  <style>
    
    #welcome-message {
    background: rgba(30, 30, 30, 0.9);
    border: 2px solid #d4af37;
    border-radius: 12px;
    padding: 25px;
    margin: 20px 0;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    position: relative;
    z-index: 10;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
    100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
}

#welcome-message h3 {
    color: #d4af37;
    margin-bottom: 15px;
}

#welcome-message p {
    color: #e0e0e0;
    margin-bottom: 20px;
}

#welcome-message button {
    background: #4a0404;
    border: 1px solid #d4af37;
    color: #e0e0e0;
    padding: 12px 25px;
    font-size: 1.1rem;
    transition: all 0.3s ease;
}

#welcome-message button:hover {
    background: #d4af37;
    color: #0a0a0a;
    box-shadow: 0 0 15px #d4af37;
}


    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #0a0a0a;
      background-image: radial-gradient(circle at 10% 20%, #2a2a2a 0%, #0a0a0a 90%);
      color: #e0e0e0;
      font-family: 'Open Sans', sans-serif;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: rgba(20, 20, 20, 0.9);
      backdrop-filter: blur(2px);
      border: 1px solid #4a0404;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
      padding: 25px;
    }

    h1, h2, h3 {
      font-family: 'Cinzel', serif;
      color: #d4af37;
      text-shadow: 0 0 5px #8b0000;
      border-bottom: 2px solid #4a0404;
      padding-bottom: 10px;
      margin: 20px 0 15px 0;
    }

    h1 {
      font-size: 2.5rem;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    h2 {
      font-size: 2rem;
    }

    h3 {
      font-size: 1.5rem;
      border-bottom: 1px solid #8b0000;
    }

    .role-icon {
      font-size: 2rem;
      filter: drop-shadow(0 0 8px #8b0000);
    }

    .role-description {
      background: rgba(0, 0, 0, 0.5);
      border-left: 5px solid #8b0000;
      padding: 20px;
      margin: 20px 0;
      border-radius: 0 12px 12px 0;
      font-style: italic;
      color: #c0c0c0;
      box-shadow: 0 0 15px rgba(139,0,0,0.3);
    }

    .role-description p {
      margin: 5px 0;
    }

    ul {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
    }

    li {
      background: rgba(30, 30, 30, 0.8);
      border-left: 5px solid #8b0000;
      padding: 12px 15px;
      border-radius: 0 8px 8px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .status.alive {
      color: #4caf50;
    }

    .status.dead {
      color: #8b0000;
    }

    button, .button {
      background: #2a0a0a;
      color: #e0e0e0;
      border: 1px solid #8b0000;
      padding: 10px 20px;
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
      margin: 5px 5px 5px 0;
    }

    button:hover {
      background: #4a0404;
      box-shadow: 0 0 15px #8b0000;
      transform: scale(1.05);
      border-color: #d4af37;
    }

    select, input, textarea {
      background: #1e1e1e;
      color: #e0e0e0;
      border: 1px solid #4a0404;
      padding: 10px;
      border-radius: 8px;
      font-family: 'Open Sans', sans-serif;
      font-size: 1rem;
      margin: 10px 0;
    }

    select {
      min-width: 200px;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #8b0000;
      box-shadow: 0 0 10px #8b0000;
    }

    .action-box {
      background: rgba(0,0,0,0.3);
      border: 1px solid #4a0404;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    #seher-result {
      margin-top: 15px;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 8px;
      border: 1px solid #8b0000;
      color: #d4af37;
      font-style: italic;
    }

    .phase-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
      padding: 15px;
      background: #1e1e1e;
      border-radius: 8px;
      border: 1px solid #4a0404;
    }

    #phase {
      color: #8b0000;
      font-weight: bold;
      text-transform: uppercase;
    }

    #chat-container {
      margin-top: 30px;
      border-top: 2px solid #4a0404;
      padding-top: 20px;
    }

    #chat-messages {
      height: 200px;
      overflow-y: auto;
      border: 1px solid #4a0404;
      background: #0f0f0f;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.95rem;
    }

    #chat-messages p {
      margin: 5px 0;
      border-bottom: 1px dotted #333;
      padding-bottom: 5px;
    }

    #chat-input {
      width: calc(100% - 110px);
      margin-right: 10px;
    }

    .chat-send {
      width: 100px;
    }

    #opferAuswahl {
      margin: 10px 0;
    }

    .hint {
      font-size: 0.9rem;
      color: #a0a0a0;
      margin-top: 5px;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      color: #4a0404;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <span class="role-icon">
        {% if rolle == "Werwolf" %}üê∫
        {% elif rolle == "Seher" %}üîÆ
        {% elif rolle == "Hexe" %}üßô
        {% elif rolle == "Amor" %}üèπ
        {% elif rolle == "Doktor" %}üíâ
        {% elif rolle == "Priester" %}‚úùÔ∏è
        {% else %}üåë
        {% endif %}
      </span>
      {{ username }} ({{ rolle }})
    </h1>

    <div class="role-description">
      {% if rolle == "Werwolf" %}
        <p>‚ÄûWenn der Vollmond aufgeht, verwandelst du dich. Deine Bestimmung ist es, zu t√∂ten! Doch das Dorf darf nichts erfahren. W√§hle dein Opfer mit Bedacht.‚Äú</p>
      {% elif rolle == "Seher" %}
        <p>‚ÄûDeine Augen sehen durch die K√∂rper. In jeder Nacht kannst du die wahre Identit√§t eines Spielers erkennen. Nutze dieses Wissen, um das Dorf zu f√ºhren oder zu t√§uschen.‚Äú</p>
      {% elif rolle == "Hexe" %}
        <p>‚ÄûDu kennst die alten Kr√§uter und Gifte. Einmal in der Nacht kannst du heilen, einmal t√∂ten. Aber der Tod ist endg√ºltig und deine Kr√§fte sind begrenzt.‚Äú</p>
      {% elif rolle == "Amor" %}
        <p>‚ÄûDein Pfeil trifft zwei Herzen. In der ersten Nacht verbindest du zwei Seelen f√ºr immer. Wenn einer stirbt, stirbt der andere vor Kummer... doch wer ist wirklich bereit f√ºr dieses Schicksal?‚Äú</p>
      {% elif rolle == "Doktor" %}
        <p>‚ÄûDu hast den Eid geschworen, Leben zu retten. Jede Nacht kannst du einen Spieler vor dem Tod bewahren. Aber h√ºte dich! Du kannst dich nicht selbst sch√ºtzen.‚Äú</p>
      {% elif rolle == "Priester" %}
        <p>‚ÄûDein Weihwasser brennt in den Adern der Dunklen. Wirf es auf einen Spieler; wenn er ein Werwolf ist, stirbt er. Aber wenn du verfehlst, stirbst du!‚Äú</p>
      {% else %}
        <p>‚ÄûDu bist ein einfaches Dorfmitglied. Du hast keine besonderen Kr√§fte, nur deine Stimme am Tag. M√∂gen die G√∂tter dich besch√ºtzen und rechtleiten.‚Äú</p>
      {% endif %}
    </div>

    <h2>‚öîÔ∏è Lebende Spieler</h2>
    <ul id="users">
      {% for player in players %}
        <li>
          {{ player.name }}
          {% if player.status %}
            <span class="status alive">‚ù§Ô∏è lebendig</span>
          {% else %}
            <span class="status dead">üíÄ tot</span>
          {% endif %}
        </li>
      {% endfor %}
    </ul>

    <div class="phase-info">
      <strong>aktuelle Phase:</strong> <span id="phase">{{ phase }}</span>
    </div>

    {% if rolle == "Werwolf" %}
    <div class="action-box">
      <h3>üê∫ Werwolf ‚Äì T√∂ter im Mondlicht</h3>
      <p>W√§hle ein Opfer, das diese Nacht sterben soll:</p>
      <select id="werwolf-target">
        {% for player in players %}
          <option value="{{ player.name }}">{{ player.name }}</option>
        {% endfor %}
      </select>
      <button onclick="sendAction('WerwolfAction', 'werwolf-target')">T√∂ten</button>

    <div id="voting-buttons-werwolf" style="margin-top: 20px; display: none;">
    <h3>Aktuelle Abstimmung:</h3>
    <div id="voting-options-werwolf"></div>
  </div>
    </div>
    {% elif rolle == "Seher" %}
    <div class="action-box">
      <h3>üîÆ Seher ‚Äì Blick durch die K√∂rper</h3>
      <p>W√§hle einen Spieler, dessen Rolle du sehen m√∂chtest:</p>
      <select id="seher-target">
        {% for player in players %}
          <option value="{{ player.name }}">{{ player.name }}</option>
        {% endfor %}
      </select>
      <button onclick="sendAction('SeherAction', 'seher-target')">Schauen</button>
      <div id="seher-result"></div>
    </div>
    {% elif rolle == "Hexe" %}
    <div class="action-box" id="hexenAktionUI">
      <h3>üßô Hexe ‚Äì Kr√§uter und Gifte</h3>
      <select id="hexenAction" onchange="toggleOpferAuswahl()">
        <option value="Heilen">Heilen</option>
        <option value="Vergiften">Vergiften</option>
        <option value="NichtsTun">Nichts tun</option>
      </select>

      <div id="opferAuswahl" style="display: none;">
        <label for="opferId">Opfer ausw√§hlen:</label>
        <select id="opferId" onchange="updateZielId()">
          {% for player in players %}
            <option value="{{ player.name }}">{{ player.name }}</option>
          {% endfor %}
        </select>
      </div>

      <input type="hidden" id="zielId" value="">

      <button onclick="sendAction('HexenAction', 'zielId')">Aktion senden</button>
    </div>
    {% elif rolle == "Amor" %}
    <div class="action-box" id="AmorAktionUI">
      <h3>üèπ Amor ‚Äì Pfeil der Liebe</h3>
      <p>Verbinde zwei Seelen f√ºr immer:</p>
      <div>
        <label for="Liebender1Id">Erster Spieler:</label>
        <select id="Liebender1Id">
          {% for player in players %}
            <option value="{{ player.name }}">{{ player.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label for="Liebender2Id">Zweiter Spieler:</label>
        <select id="Liebender2Id">
          {% for player in players %}
            <option value="{{ player.name }}">{{ player.name }}</option>
          {% endfor %}
        </select>
      </div>

      <button onclick="sendAction('AmorAction', 'EmptyTarget')">Liebespaar verzaubern</button>
    </div>
    {% elif rolle == "Doktor" %}
    <div class="action-box">
      <h3>üíâ Doktor ‚Äì Heiler der Nacht</h3>
      <p>W√§hle einen Spieler, den du diese Nacht sch√ºtzen m√∂chtest:</p>
      <select id="doktor-target">
        {% for player in players %}
          <option value="{{ player.name }}">{{ player.name }}</option>
        {% endfor %}
      </select>
      <button onclick="sendAction('DoktorAction', 'doktor-target')">Besch√ºtzen</button>
      <button onclick="sendAction('DoktorAction')">Nichts tun</button>
    </div>
    {% elif rolle == "J√§ger" %}
    <div>
      <h3>J√§ger-Aktion</h3>
      <p>W√§hle einen Spieler den du im fall deines Todes mit dir nehmen willst</p>
      <select id="jaeger-target">
        {% for player in players %}
          <option value="{{ player.name }}">{{ player.name }}</option>
        {% endfor %}
      </select>
      <button onclick="sendAction('JaegerAction', 'jaeger-target')">Mit dir nehmen</button>
      <button onclick="sendAction('JaegerAction')">Ziel zur√ºcknehmen</button>
    </div>
    {% elif rolle == "Priester" %}
    <div class="action-box">
      <h3>‚úùÔ∏è Priester ‚Äì Heiliges Wasser</h3>
      <p>W√§hle einen Spieler, den du mit heiligem Wasser bewerfen willst:</p>
      <select id="priester-target">
        {% for player in players %}
          <option value="{{ player.name }}">{{ player.name }}</option>
        {% endfor %}
      </select>
      <button onclick="sendAction('PriesterAction', 'priester-target')">Bewerfen</button>
      <button onclick="sendAction('PriesterAction')">Nichts tun</button>
    </div>
    {% endif %}

    {% if phase == "Tag" %}
    <div class="action-box">
      <h3>üåû Tag der Abrechnung ‚Äì Das Urteil der Dorfbewohner</h3>
      <p>W√§hle einen Spieler zum Lynchen:</p>
      <select id="tag-target">

      {% for player in players %}
        <option value="{{ player.name }}">{{ player.name }}</option>
      {% endfor %}
    </select>
    <button onclick="sendAction('TagAction', 'tag-target')">Lynchen</button>
    <button id="lynch-button" onclick="sendAction('TagAction', 'tag-target')">Lynchen</button>
  </div>

  <div id="voting-buttons" style="flex: 1; display: none;">
    <h3>Aktuelle Abstimmung:</h3>
    <div id="voting-options"></div>
  </div>
</div>
{% elif phase == "Spielbeginn" %}
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-top: 20px;">
  <div style="flex: 1; margin-right: 20px;">
    <h3>Tag-Aktion ‚Äì Lynchen</h3>
    <p>W√§hle einen Spieler zum Lynchen:</p>
    <select id="tag-target">
      {% for player in players %}
        <option value="{{ player.name }}">{{ player.name }}</option>
      {% endfor %}
    </select>
    <button id="lynch-button" onclick="sendAction('TagAction', 'tag-target')">Lynchen</button>
  </div>

  <div style="display: flex; justify-content: center; margin-top: 20px;">
    <div id="welcome-message" style="max-width: 500px; width: 100%;">
        <h3>Willkommen im Spiel, {{ username }}!</h3>
        <p>Mach dich zun√§chst mit deiner Rolle und den Funktionen vertraut. Wenn du bereit bist, dr√ºcke bitte "Verstanden".</p>
        <button onclick="sendAction('IngameBereit')">Verstanden</button>
    </div>
</div>

  <div id="voting-buttons" style="flex: 1; display: none;">
    <h3>Aktuelle Abstimmung:</h3>
    <div id="voting-options"></div>
  </div>
</div>
    {% endif %}

    <div id="chat-container">
      <h3>üí¨ Gefl√ºster der Spieler</h3>
      <div id="chat-messages"></div>
      <div>
        <input type="text" id="chat-input" placeholder="Nachricht in die Runde werfen...">
        <button class="chat-send" onclick="sendChatMessage()">Senden</button>
      </div>
    </div>

    <footer>Die Nacht ist dunkel und voller Schrecken ‚Ä¶</footer>
  </div>

  <script>
    let socket;

    function connectWebSocket() {
      socket = new WebSocket(`ws://${window.location.host}/ws`);

      socket.onopen = () => {
        console.log("WebSocket verbunden!");
      };

      socket.onclose = () => {
        console.log("WebSocket Verbindung verloren. Versuche neu zu verbinden...");
        setTimeout(connectWebSocket, 1000);
      };

      socket.onerror = (error) => {
        console.error("WebSocket-Fehler:", error);
      };

      socket.onmessage = function(event) {
        const data = JSON.parse(event.data);
        if (data.type === "GAME_RESET") {
                alert("Das Spiel wurde zur√ºckgesetzt. Bitte neu beitreten.")
                socket.close();
            }
        if (data.type === "GAME_STATE") {
          const usersList = document.getElementById("users");
          usersList.innerHTML = data.state.players
            .map(p => `<li>${p.name} <span class="status ${p.status ? 'alive' : 'dead'}">${p.status ? '‚ù§Ô∏è lebendig' : 'üíÄ tot'}</span></li>`)
            .join("");
          document.getElementById("phase").textContent = data.state.phase;

          const votingButtonsDiv = document.getElementById("voting-buttons");
          const votingOptionsDiv = document.getElementById("voting-options");

          if (data.state.ongoing_vote && data.state.phase === "Tag") {
          votingButtonsDiv.style.display = "block";
          votingOptionsDiv.innerHTML = Object.entries(data.state.current_votes)
            .map(([target, voters]) => `
            <button
                    onclick="sendAction('TagAction', '${target}')"
                    style="margin: 5px; padding: 8px 16px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;"
                >
                    ${target} (Stimmen: ${voters.length})
                </button>
            `)
            .join("");
            } else {
            votingButtonsDiv.style.display = "none";
            }
            const votingButtonsWerwolf = document.getElementById("voting-buttons-werwolf");
            const votingOptionsWerwolf = document.getElementById("voting-options-werwolf");
            if (data.state.ongoing_vote && data.state.phase === "Werw√∂lfePhase" && data.state.eligible_players.includes("{{ username }}")) {
            votingButtonsWerwolf.style.display = "block";
            votingOptionsWerwolf.innerHTML = Object.entries(data.state.current_votes)
                .map(([target, voters]) => `
                <button
                    onclick="sendAction('WerwolfAction', '${target}')"
                    style="margin: 5px; padding: 8px 16px; background-color: #F44336; color: white; border: none; border-radius: 4px; cursor: pointer;"
                >
                    ${target} (Stimmen: ${voters.length})
                </button>
                `)
                .join("");
            } else if (votingButtonsWerwolf) {
            votingButtonsWerwolf.style.display = "none";
            }

          if (data.state.last_seher_result) {
            const seherResultDiv = document.getElementById("seher-result");
            seherResultDiv.textContent = data.state.last_seher_result;
            seherResultDiv.style.display = "block";
          }
         } else if (data.type === "CHAT_MESSAGE") {
            appendChatMessage(data.data.sender, data.data.message);
        } else if (data.type === "WINNER") {
    showWinnerPage(data.winner);}

      };
    }

    document.addEventListener("DOMContentLoaded", function() {
    connectWebSocket();
    const welcomeMessage = document.getElementById("welcome-message");
    if (welcomeMessage) {
        welcomeMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
});

function sendAction(type, targetOrId) {
  if (!socket || socket.readyState !== WebSocket.OPEN) {
    alert("Keine Verbindung zum Server!");
    return;
  }

  let message;

  // "Verstanden"-Button f√ºr Spielbeginn
  if (type === "IngameBereit") {
    message = {
      type: type,
      data: {
        username: "{{ username }}",
        ready: true
      }
    };
    socket.send(JSON.stringify(message));
    document.getElementById('welcome-message').style.display = 'none';
    return;
  }

 // Amor-Aktion: "Nichts tun"
 /* if (type === "AmorAction" && !targetOrId) {
    message = {
      type: type,
      data: {
        actor: "{{ username }}",
        target1: null,  // null f√ºr Option<String>::None
        target2: null,  // null f√ºr Option<String>::None
      }
    };
  }
  // Amor-Aktion: Liebespaar verzaubern
  else*/ if (type === "AmorAction") {
    message = {
      type: type,
      data: {
        actor: "{{ username }}",
        target1: document.getElementById("Liebender1Id").value,
        target2: document.getElementById("Liebender2Id").value,
      }
    };
  }
  // Hexen-Aktion
  else if (type === "HexenAction") {
    const hexenAktion = document.getElementById("hexenAction").value;
    if (hexenAktion === "NichtsTun" || !targetOrId) {
      message = {
        type: type,
        data: {
            direction: {
                actor: "{{ username }}",
                target: "NONE",
            },
          hexenAktion: "NichtsTun",
        }
      };
    } else {
      const target = document.getElementById("opferId").value;
      message = {
        type: type,
        data: {
          direction: {
                actor: "{{ username }}",
                target: "NONE",
            },
          hexenAktion: hexenAktion,
          extra_target: hexenAktion === "Vergiften" ? target : "None",
        }
      };
    }
  }
 // Doktor-Aktion: "Nichts tun"
  else if (type === "DoktorAction" && !targetOrId) {
    message = {
      type: type,
      data: {
        direction: {
          actor: "{{ username }}",
          target: null,  // null f√ºr Option<String>::None
        }
      }
    };
  }
  // Seher-Aktion: "Nichts tun"
  else if (type === "SeherAction") {
    const target = document.getElementById("seher-target").value;
    message = {
      type: type,
      data: {
          actor: "{{ username }}",
          target: target,  
      }
    };
  }
  // J√§ger-Aktion: "Ziel zur√ºcknehmen"
  else if (type === "JaegerAction" && !targetOrId) {
    message = {
      type: type,
      data: {
        actor: "{{ username }}",
        target: null,  // null f√ºr Option<String>::None
      }
    };
  }
  // Priester-Aktion: "Nichts tun"
  else if (type === "PriesterAction" && !targetOrId) {
    message = {
      type: type,
      data: {
        actor: "{{ username }}",
        target: null, 
      }
    };
  }
  else if (type === "PriesterAction" && targetOrId) {
    const target = document.getElementById("priester-target").value;
    message = {
      type: type,
      data: {
        actor: "{{ username }}",
        target: target, 
      }
    };
  }
  else if (type === "WerwolfAction") {
    // Wenn targetOrId ein String ist (z. B. "Max Mustermann"), direkt verwenden
    const target = (typeof targetOrId === "string" && targetOrId !== "werwolf-target")
      ? targetOrId
      : document.getElementById("werwolf-target").value;
    message = {
      type: type,
      data: {
        direction: {
          actor: "{{ username }}",
          target: target,
        }
      }
    };
  }
  else if (type === "TagAction") {
    // Wenn targetOrId ein String ist (z. B. "Max Mustermann"), direkt verwenden
    const target = (typeof targetOrId === "string" && targetOrId !== "tag-target")
      ? targetOrId
      : document.getElementById("tag-target").value;
    message = {
      type: type,
      data: {
        direction: {
          actor: "{{ username }}",
          target: target,
        }
      }
    };
  }
  // Standardfall f√ºr alle anderen Aktionen mit Target
  else {
    const target = typeof targetOrId === "string" ? document.getElementById(targetOrId).value : targetOrId;
    message = {
      type: type,
      data: {
        direction: {
          actor: "{{ username }}",
          target: target,  // String f√ºr Option<String>::Some
        }
      }
    };
  }

  socket.send(JSON.stringify(message));
}


    function sendChatMessage() {
  const input = document.getElementById("chat-input");
  const message = input.value.trim();
  if (message && socket && socket.readyState === WebSocket.OPEN) {
    const chatMessage = {
      type: "ChatMessage",
      data: {
        sender: "{{ username }}",
        message: message
      }
    };
    socket.send(JSON.stringify(chatMessage));
    input.value = "";
  }
}

function appendChatMessage(sender, message) {
  const chatMessages = document.getElementById("chat-messages");
  chatMessages.innerHTML += `<p><strong>${sender}:</strong> ${message}</p>`;
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function toggleOpferAuswahl() {
  const hexenAktion = document.getElementById("hexenAktion").value;
  const opferAuswahl = document.getElementById("opferAuswahl");
  if (hexenAktion === "Vergiften") {
    opferAuswahl.style.display = "block";
    updateZielId();
  } else {
    opferAuswahl.style.display = "none";
    document.getElementById("zielId").value = "";
  }
}

function updateZielId() {
  const opferId = document.getElementById("opferId").value;
  document.getElementById("zielId").value = opferId;
}


    function showWinnerPage(winner) {
      document.body.innerHTML = `
        <!DOCTYPE html>
        <html lang="de">
        <head>
          <meta charset="utf-8">
          <title>Werwolf ‚Äì Sieger</title>
          <style>

            @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap');
            
            * { 
              margin: 0; 
              padding:0; 
              box-sizing:border-box; 
            }

            body {
              background: #0a0a0a;
              color: #e0e0e0;
              font-family: 'Open Sans', sans-serif;
              min-height: 100vh;
              display: flex;
              align-items: center;
              justify-content: center;
            }

            .container {
              max-width: 600px;
              background: rgba(20,20,20,0.9);
              border: 1px solid #4a0404;
              border-radius: 12px;
              box-shadow: 0 0 20px #8b0000;
              padding: 30px;
              text-align: center;
            }

            h1 { 
              font-family: 'Cinzel', serif; 
              color: #d4af37; 
              border-bottom: 2px solid #4a0404; 
              padding-bottom: 15px; 
            }

            p { 
              margin: 20px 0; 
              font-size: 1.2rem; 
            }

            button, a {
              background: #2a0a0a;
              color: #e0e0e0;
              border: 1px solid #8b0000;
              padding: 10px 20px;
              font-family: 'Cinzel', serif;
              border-radius: 25px;
              cursor: pointer;
              transition: all 0.3s ease;
              text-decoration: none;
              display: inline-block;
            }

            button:hover, a:hover {
              background: #4a0404;
              box-shadow: 0 0 15px #8b0000;
            }

          </style>
        </head>
        <body>
          <div class="container">
            <h1>Spiel beendet!</h1>
            <p>Der Sieger ist: ${winner}</p>
            <button id="newGameButton">neues Spiel starten</button>
            <a href="/">‚Ü© zur√ºck zum aktuellen Spiel</a>
          </div>
          <script>
            let socket;
            function connectWebSocket() {
              socket = new WebSocket(\`ws://\${window.location.host}/ws\`);
              socket.onopen = () => console.log("WS verbunden");
              socket.onclose = () => setTimeout(connectWebSocket, 1000);
            }
            document.addEventListener('DOMContentLoaded', function() {
              connectWebSocket();
              document.getElementById('newGameButton').addEventListener('click', () => {
                if (socket && socket.readyState === WebSocket.OPEN) {
                  socket.send(JSON.stringify({ type: "reset_game" }));
                } else {
                  fetch('/reset_game', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => { if (data.success) window.location.reload(); });
                }
              });
            });
          <\/script>
        </body>
        </html>
      `;
    }

    document.addEventListener("DOMContentLoaded", function() {
      connectWebSocket();
      const chatInput = document.getElementById("chat-input");
      if (chatInput) {
        chatInput.addEventListener("keypress", function(event) {
          if (event.key === "Enter") {
            sendChatMessage();
          }
        });
      }
    });
  </script>
</body>
</html>